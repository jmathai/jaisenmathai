<p>UPDATE: You can <a target="_blank" href="http://github.com/jmathai">watch me on GitHub</a>, <a target="_blank" href="http://wiki.github.com/jmathai/twitter-async">view documentation</a> or <a target="_blank" href="https://github.com/jmathai/twitter-async/tree">fork the project</a>.</p>
<p>Twitter recently added a feature to their API that let's you allow users to sign into your site with their twitter username and password.  I recently wrote a blog post on <a target="_blank" href="http://www.jaisenmathai.com/blog/2009/03/31/how-to-quickly-integrate-with-twitters-oauth-api-using-php/">how to use Twitter's OAuth API</a>.  This feature is a natural progression in allowing Twitter users to securely sign into your site.<span id="more-123"></span></p>
<h3>Experience how it works</h3>
<p>I've set up a basic example on this site.  <a href="/sign_in_with_twitter/start.php">Try it out here</a>.  The files used in this example are <a href="/files/sign_in_with_twitter.zip">available for download</a> and should work on your server if you follow the steps.</p>
<h3>Getting up to date</h3>
<p>If you experience any problems then make sure you are using the latest version of the code.  <a target="_blank" href="https://github.com/jmathai/twitter-async/tree">It's available on Github</a>.</p>
<h3>Setting up your application on Twitter</h3>
<p>The first step is to set up your application on Twitter.  You can add an application on <a target="_blank" href="http://twitter.com/oauth_clients/">Twitters OAuth clients page</a>.  Click on <em>register a new application</em> and fill out all the fields.  The two important fields are:<br>
   * Callback URL: The location of confirm.php on your server (http://yourdomain.com/confirm.php)<br>
   * User Twitter for login: Check this!<br>
Once you've created your application you will need to copy and paste your consumer key and secret into secret.php.</p>
<h3>Seeing it all in action</h3>
<p>That's it.  Browse to start.php on your server and follow the flow.  You'll be asked to log in to twitter if you're not already.  Once you log in, Twitter will confirm that you want to allow your application access to your account.  Clicking confirm will take you back to your callback url along with a request token.  You'll exchange your request token for an access token which you can use to authenticate as yourself (or whoever is going through flow).  For the sake of this exercise we are saving the access token to a cookie.  We use the access token to retrieve your profile and place a link to another page.  This other page will use the access token from your cookie and get a listing of all your friends.</p>
<p>The beauty of this is that once a user allows your application access to their account they don't have to do it again.  This means that the next time they visit your site and click on the link to sign in with twitter, it will immediately redirect them to your callback page with the request token.  It's all very seamless because from the user's perspective if they are logged into Twitter they are logged into your site.  Very cool.</p>
<h3>A look at the code</h3>
<p>Every file loads in the dependencies.  These are the includes at the top of each page.</p>
<pre name="code" class="php">include 'EpiCurl.php';
include 'EpiOAuth.php';
include 'EpiTwitter.php';
include 'secret.php';</pre>
<p>Anytime you want to make requests to Twitter you need to instantiate the EpiTwitter class.  The constructor takes a minimum of two parameters: your consumer key and consumer secret.</p>
<pre name="code" class="php">$twitterObj = new EpiTwitter($consumer_key, $consumer_secret);</pre>
<p>To obtain the authenticate url which starts the flow you simply call the correct function.</p>
<pre name="code" class="php">$authenticateUrl = $twitterObj-&gt;getAuthenticateUrl();</pre>
<p>Once the user authenticates with Twitter they are redirected back to your callback url along with a request token.  We need to exchange the request token for an access token.  For simplicity we will save the access token to a cookie so we can make subsequent calls.  On this page we will use the setToken method to set the access token and secret.  As we will see on the next page, these can be passed in as parameters to the constructor as well.</p>
<pre name="code" class="php">$twitterObj-&gt;setToken($_GET['oauth_token']);
$token = $twitterObj-&gt;getAccessToken();
$twitterObj-&gt;setToken($token-&gt;oauth_token, $token-&gt;oauth_token_secret);
setcookie('oauth_token', $token-&gt;oauth_token);
setcookie('oauth_token_secret', $token-&gt;oauth_token_secret);</pre>
<p>Since we saved the access token in a cookie we can make calls to twitter on behalf of the user for as long as the cookies are valid.</p>
<pre name="code" class="php">$twitterObj = new EpiTwitter($consumer_key, $consumer_secret,
    $_COOKIE['oauth_token'], $_COOKIE['oauth_token_secret']);

$twitterInfo= $twitterObj-&gt;get_statusesFriends();
try{
  foreach($twitterInfo as $friend) {
    echo $friend-&gt;screen_name;
  }
}catch(EpiTwitterException $e){
  echo $e-&gt;getMessage();
}</pre>
<p><em>Update: If you don't access any of the response variables then there is no guarantee that the call completes.  This should also be done in a try/catch block since a non-200 response will throw an exception.</em></p>
<p>That's all!  If you're still interested in learning more about OAuth then the following links are invaluable.</p>
<ul>
<li><a target="_blank" href="http://wiki.github.com/jmathai/twitter-async">http://wiki.github.com/jmathai/twitter-async</a></li>
<li><a target="_blank" href="http://apiwiki.twitter.com/Twitter-API-Documentation">http://apiwiki.twitter.com/Twitter-API-Documentation</a></li>
<li><a target="_blank" href="http://oauth.net/core/1.0/">http://oauth.net/core/1.0/</a></li>
<li><a target="_blank" href="http://www.hueniverse.com/hueniverse/2008/10/beginners-gui-1.html">http://www.hueniverse.com/hueniverse/2008/10/beginners-gui-1.html</a></li>
</ul>
